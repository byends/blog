(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{175:function(s,t,a){s.exports=a.p+"assets/img/beanstalkd-and-supervisor_2.8815013a.jpg"},176:function(s,t,a){s.exports=a.p+"assets/img/beanstalkd-and-supervisor_1.97601423.jpg"},182:function(s,t,a){"use strict";a.r(t);var n=[function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("TIP")]),t("p",[this._v("Beanstalkd 没有提供主备同步以及故障切换机制，在应用中有成为单点的风险。实际应用中，可以用数据库为任务 (job) 提供持久化存储。另外，和 memcached 类似，Beanstalkd 依赖 libevent 的单线程事件分发机制，不能有效利用多核 cpu 的性能，这一点可以通过单机部署多个实例克服。")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("git clone https://github.com/kr/beanstalkd.git\ncd beanstalkd\nmake\nmv beanstalkd /usr/local/bin/\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br"),t("span",{staticClass:"line-number"},[this._v("3")]),t("br"),t("span",{staticClass:"line-number"},[this._v("4")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行","aria-hidden":"true"}},[this._v("#")]),this._v(" 运行")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("beanstalkd -l 127.0.0.1 -p 11300 port -c -b /data/logs/beanstalkd/\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("查看支持的命令"),t("br"),t("img",{attrs:{src:a(176),alt:"查看支持的命令"}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"简单的生产者：producer-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简单的生产者：producer-php","aria-hidden":"true"}},[this._v("#")]),this._v(" 简单的生产者："),t("code",[this._v("producer.php")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("require_once")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'src/Client.php'")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{attrs:{class:"token package"}},[s._v("Beanstalk"),a("span",{attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Client")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token variable"}},[s._v("$beanstalk")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("Client")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token variable"}},[s._v("$beanstalkd")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token function"}},[s._v("useTube")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'default'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// 一次压入多条消息")]),s._v("\n"),a("span",{attrs:{class:"token variable"}},[s._v("$n")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("10")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$n")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token variable"}},[s._v("$delay")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("30")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token variable"}},[s._v("$beanstalkd")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token function"}},[s._v("put")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        "),a("span",{attrs:{class:"token number"}},[s._v("2")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("// priority.")]),s._v("\n        "),a("span",{attrs:{class:"token variable"}},[s._v("$delay")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),a("span",{attrs:{class:"token comment"}},[s._v("//  delay. 秒数")]),s._v("\n        "),a("span",{attrs:{class:"token number"}},[s._v("3")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("// run time")]),s._v("\n        "),a("span",{attrs:{class:"token double-quoted-string string"}},[s._v('"beanstalkd '),a("span",{attrs:{class:"token interpolation"}},[a("span",{attrs:{class:"token variable"}},[s._v("$n")])]),s._v(" delay "),a("span",{attrs:{class:"token interpolation"}},[a("span",{attrs:{class:"token variable"}},[s._v("$delay")])]),s._v('"')]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("// The job's body.")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token variable"}},[s._v("$n")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'done!'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("php -S localhost:8080 producer.php\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"简易的消费者：consumer-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简易的消费者：consumer-php","aria-hidden":"true"}},[this._v("#")]),this._v(" 简易的消费者："),t("code",[this._v("consumer.php")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token variable"}},[s._v("$beanstalk")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("Client")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token variable"}},[s._v("$beanstalk")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token function"}},[s._v("connect")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token variable"}},[s._v("$beanstalk")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token function"}},[s._v("watch")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'default'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// 监听一定数目后退出")]),s._v("\n"),a("span",{attrs:{class:"token variable"}},[s._v("$limit")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("20")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'start consumer'")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("chr")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("10")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$limit")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("// reserve 会阻塞进程，适当设置超时时间，比如 5 秒超时后进入下一次等待")]),s._v("\n        "),a("span",{attrs:{class:"token variable"}},[s._v("$job")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("$this")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token property"}},[s._v("beanstalkd")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token function"}},[s._v("reserve")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("5")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n        "),a("span",{attrs:{class:"token function"}},[s._v("var_dump")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$job")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$job")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{attrs:{class:"token comment"}},[s._v("//$jobStats = $this->beanstalkd->statsJob($job['id']);")]),s._v("\n            "),a("span",{attrs:{class:"token variable"}},[s._v("$this")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token property"}},[s._v("beanstalkd")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token function"}},[s._v("delete")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$job")]),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'id'")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{attrs:{class:"token function"}},[s._v("sleep")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("5")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{attrs:{class:"token comment"}},[s._v("// if ($jobStats['reserves'] > 8) {")]),s._v("\n            "),a("span",{attrs:{class:"token comment"}},[s._v("//     $this->beanstalkd->bury($jobStats['id'], $jobStats['pri']);")]),s._v("\n            "),a("span",{attrs:{class:"token comment"}},[s._v("// }")]),s._v("\n            "),a("span",{attrs:{class:"token function"}},[s._v("cilog")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$job")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("chr")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("10")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("$limit")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("chr")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("10")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{attrs:{class:"token variable"}},[s._v("$limit")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'end'")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("chr")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("10")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("/usr/local/php7/bin/php consumer.php\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志","aria-hidden":"true"}},[this._v("#")]),this._v(" 日志")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"查看消息列队"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看消息列队","aria-hidden":"true"}},[this._v("#")]),this._v(" 查看消息列队")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("telnet 127.0.0.1 11300\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("stats")]),t("li",[this._v("list-tubes")]),t("li",[this._v("list-tube-used")]),t("li",[this._v("list-tubes-watched")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("use default")]),t("li",[this._v("stats-tube default")]),t("li",[this._v("stats-job 2")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"安装-supervisor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-supervisor","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装 supervisor")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum -y "),a("span",{attrs:{class:"token function"}},[s._v("install")]),s._v(" python-setuptools\neasy_install supervisor\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("# 或 pip install supervisor")]),s._v("\n\n"),a("span",{attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/supervisor/\n"),a("span",{attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/supervisor/conf.d\necho_supervisord_conf "),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/supervisor/supervisord.conf\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[this._v("vi")]),this._v(" /etc/supervisor/supervisord.conf\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[this._v("vi")]),this._v(" etc/supervisor/conf.d/beanstalkd.conf\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[this._v("vi")]),this._v(" /etc/supervisor/conf.d/queue.conf\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("supervisord -c /etc/supervisor/supervisord.conf\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("默认使用 tcp 连接，即在配置中开启 inet_http_server 配置")]),t("li",[this._v("使用 unix 域套接字，即开启 unix_http_server 配置")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("supervisorctl -c /etc/supervisor/supervisord.conf status\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:a(175),alt:"查看支持的命令"}})])}],e=a(0),r=Object(e.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("p",[s._v("前面有说到延迟消息队列的选择，可移步查看："),a("router-link",{attrs:{to:"./php-delay-queue.html"}},[s._v("谁才是PHP实现延迟消息队列的最佳CP？")])],1),s._m(0),s._m(1),s._m(2),s._m(3),s._m(4),s._m(5),s._m(6),a("p",[s._v("推荐PHP beanstalkd 客户端："),a("a",{attrs:{href:"https://github.com/davidpersson/beanstalk",target:"_blank",rel:"noopener noreferrer"}},[s._v("davidpersson/beanstalk"),a("OutboundLink")],1)]),s._m(7),a("p",[s._v("可用 PHP 内置 Webserver 启动：")]),s._m(8),s._m(9),s._m(10),s._m(11),a("p",[s._v("运行后命令行会输出相应的结果。")]),s._m(12),a("p",[s._v("Beanstalkd 可以开启binlog，如果遇到 Benstalkd 进程因为某些原因挂了，或者机器需要重启时，Beanstalkd 都能轻松地从 binlog 恢复这些消息。\nbeanstalkd 的 binlog 位于 -b 选项指定的文件夹中，名字就叫 binlog.$order。binlog 的序号 $order 从 1 开始，逐一递增。\nbinlog 文件大小是固定的，可以通过 -s 选项指定，默认为 10M。")]),s._m(13),a("p",[s._v("Beanstalkd 和 memcached 一样，采用 TCP 通信，想要进入它的命令行模式，需要使用 telnet")]),s._m(14),a("p",[s._v("常用的一些命令：")]),s._m(15),a("p",[s._v("切换到某个队列查看：")]),s._m(16),a("p",[s._v("更多命令查看这里："),a("a",{attrs:{href:"https://github.com/kr/beanstalkd/blob/master/doc/protocol.zh-CN.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("Beanstalkd中文协议"),a("OutboundLink")],1),a("br"),s._v("\n推荐一个网页版的管理控制台："),a("a",{attrs:{href:"https://github.com/ptrofimov/beanstalk_console",target:"_blank",rel:"noopener noreferrer"}},[s._v("beanstalk_console"),a("OutboundLink")],1)]),s._m(17),s._m(18),a("p",[s._v("编辑配置文件:")]),s._m(19),a("p",[s._v("在最后面添加 :\n[include]\nfiles = /etc/supervisor/conf.d/*.conf")]),a("p",[s._v("然后添加 beanstalkd 服务:")]),s._m(20),a("p",[s._v("输入:\n[program:beanstalkd]\ncommand=/usr/local/bin/beanstalkd -l 127.0.0.1 -p 11300 -c -b /data/logs/beanstalkd/")]),a("p",[s._v("添加服务")]),s._m(21),a("p",[s._v("输入\n[program:queue]\nuser=nobody\ncommand=/usr/local/php7/bin/php /usr/local/project/htdocs/consumer.php\nprocess_name=%(program_name)s_%(process_num)02d\nnumprocs=2\nnumprocs_start=1")]),a("p",[s._v("启动服务:")]),s._m(22),a("p",[s._v("supervisorctl 是 supervisor 管理工具，可启动、关闭、查看由 supervisor 维护的进程")]),a("p",[s._v("它有两种运行方式：")]),s._m(23),a("p",[s._v("查看状态：")]),s._m(24),a("p",[s._v("查看/管理所有服务的状态:")]),s._m(25),a("p",[s._v("这里有 supervisor 现成的 *nux "),a("a",{attrs:{href:"https://github.com/Supervisor/initscripts",target:"_blank",rel:"noopener noreferrer"}},[s._v("服务脚本"),a("OutboundLink")],1),s._v("\ncentos 的机器可以选择 redhat-init-mingalevme，下载后修改里面的配置文件路径，改成："),a("code",[s._v("/etc/supervisor/supervisord.conf")])]),a("p",[s._v("参考资料："),a("br"),a("a",{attrs:{href:"http://supervisord.org/configuration.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Supervisor Configuration File"),a("OutboundLink")],1)])])},n,!1,null,null,null);t.default=r.exports}}]);